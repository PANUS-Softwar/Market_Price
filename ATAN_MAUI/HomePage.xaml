<?xml version="1.0" encoding="utf-8" ?>
<ContentPage 
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    x:Class="ATAN_MAUI.HomePage"
    x:Name="HomePageRef"
    Title="Market Prices">

    <Grid RowDefinitions="Auto, *, Auto">

        <!-- SEARCH BAR -->
        <SearchBar 
            Placeholder="Search commodities..."
            x:Name="CommoditySearchBar"
            Margin="15"
            TextChanged="OnSearchTextChanged" />

        <!-- MAIN CONTENT -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="20" Padding="15">

                <!-- COMMODITY TYPES LIST -->
                <CollectionView x:Name="CommodityListView" SelectionMode="None">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Frame BorderColor="#ddd" CornerRadius="12" Padding="15" Margin="0,0,0,10">

                                <VerticalStackLayout Spacing="10">

                                    <!-- Commodity Type Name -->
                                    <Label Text="{Binding Name}"
                                           FontAttributes="Bold"
                                           FontSize="18" />

                                    <!-- Competitive Bid / Ask Prices -->
                                    <HorizontalStackLayout>
                                        <Label Text="Bid:" FontAttributes="Bold" />
                                        <Label Text="{Binding BidPrice}" />

                                        <Label Text="   Ask:" FontAttributes="Bold" />
                                        <Label Text="{Binding AskPrice}" />
                                    </HorizontalStackLayout>

                                    <!-- Dropdown for less competitive prices -->
                                    <toolkit:Expander>
                                        <toolkit:Expander.Header>
                                            <Label Text="View less competitive prices" TextColor="Gray" />
                                        </toolkit:Expander.Header>

                                        <toolkit:Expander.Content>
                                            <VerticalStackLayout Spacing="5" Padding="5, 0, 0, 0">
                                                <Label Text="Other Prices:" FontAttributes="Bold" />
                                                <CollectionView ItemsSource="{Binding OtherPrices}">
                                                    <CollectionView.ItemTemplate>
                                                        <DataTemplate>
                                                            <Label Text="{Binding}" Margin="5" />
                                                        </DataTemplate>
                                                    </CollectionView.ItemTemplate>
                                                </CollectionView>
                                            </VerticalStackLayout>
                                        </toolkit:Expander.Content>
                                    </toolkit:Expander>

                                    <!-- ENTER A BID/OFFER -->
                                    <VerticalStackLayout Spacing="5" Margin="0,10,0,0">
                                        <Label Text="Enter Bid/Offer" FontAttributes="Bold" />

                                        <Entry
                                            Placeholder="Enter price..." 
                                            Keyboard="Numeric"
                                            Text="{Binding UserEnteredPrice}" />

                                        <Button 
                                            Text="Submit Bid/Offer"
                                            Command="{Binding Source={x:Reference HomePageRef}, Path=BindingContext.SubmitBidCommand}"
                                            CommandParameter="{Binding}"
                                            BackgroundColor="#00897B"
                                            TextColor="White"
                                            CornerRadius="8" />
                                    </VerticalStackLayout>

                                </VerticalStackLayout>

                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

            </VerticalStackLayout>
        </ScrollView>

        <!-- BOTTOM NAVIGATION -->
        <Grid Grid.Row="2" BackgroundColor="#f1f1f1" Padding="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <Button Text="Home" Grid.Column="0" Clicked="GoHome" />
            <Button Text="Activities" Grid.Column="1" Clicked="GoActivities" />
            <Button Text="Settings" Grid.Column="2" Clicked="GoSettings" />

        </Grid>

    </Grid>

</ContentPage>
